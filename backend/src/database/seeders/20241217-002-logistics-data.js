'use strict';
const { v4: uuidv4 } = require('uuid');

module.exports = {
  async up(queryInterface, Sequelize) {
    const now = new Date();

    // Get field IDs
    const [fields] = await queryInterface.sequelize.query(
      `SELECT id, code, name FROM fields LIMIT 3`
    );

    // Get admin user
    const [users] = await queryInterface.sequelize.query(
      `SELECT id FROM users WHERE username = 'admin' LIMIT 1`
    );
    const adminId = users.length > 0 ? users[0].id : null;

    const fieldId1 = fields.length > 0 ? fields[0].id : null;
    const fieldId2 = fields.length > 1 ? fields[1].id : null;

    // Storage Tanks
    const tanks = [
      {
        id: uuidv4(),
        code: 'TNK-0001',
        name: 'Tanque Principal de Crudo',
        location: 'Estación Central',
        field_id: fieldId1,
        type: 'CRUDE',
        capacity: 50000.00,
        current_volume: 32500.00,
        diameter_ft: 120.00,
        height_ft: 48.00,
        last_gauging_date: new Date(),
        status: 'ACTIVE',
        notes: 'Tanque principal para almacenamiento de crudo',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'TNK-0002',
        name: 'Tanque de Agua de Producción',
        location: 'Estación Central',
        field_id: fieldId1,
        type: 'WATER',
        capacity: 25000.00,
        current_volume: 18750.00,
        diameter_ft: 80.00,
        height_ft: 40.00,
        last_gauging_date: new Date(),
        status: 'ACTIVE',
        notes: 'Tanque para agua de producción',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'TNK-0003',
        name: 'Tanque de Diesel',
        location: 'Área de Combustibles',
        field_id: fieldId1,
        type: 'DIESEL',
        capacity: 10000.00,
        current_volume: 7500.00,
        diameter_ft: 40.00,
        height_ft: 30.00,
        last_gauging_date: new Date(),
        status: 'ACTIVE',
        notes: 'Tanque de almacenamiento de diesel para operaciones',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'TNK-0004',
        name: 'Tanque Secundario de Crudo',
        location: 'Estación Norte',
        field_id: fieldId2,
        type: 'CRUDE',
        capacity: 35000.00,
        current_volume: 21000.00,
        diameter_ft: 100.00,
        height_ft: 45.00,
        last_gauging_date: new Date(),
        status: 'ACTIVE',
        notes: 'Tanque secundario para crudo',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'TNK-0005',
        name: 'Tanque de Condensado',
        location: 'Planta de Gas',
        field_id: fieldId2,
        type: 'CONDENSATE',
        capacity: 15000.00,
        current_volume: 8500.00,
        diameter_ft: 60.00,
        height_ft: 35.00,
        last_gauging_date: new Date(),
        status: 'ACTIVE',
        notes: 'Tanque para almacenamiento de condensado',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
    ];

    await queryInterface.bulkInsert('storage_tanks', tanks);

    // Tank Gaugings
    const gaugings = [
      {
        id: uuidv4(),
        tank_id: tanks[0].id,
        gauging_datetime: new Date(),
        volume: 32500.00,
        temperature: 85.5,
        api_gravity: 28.5,
        bsw: 0.5,
        level_inches: 384.00,
        gauged_by: adminId,
        gauging_method: 'MANUAL',
        notes: 'Medición matutina',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tank_id: tanks[0].id,
        gauging_datetime: new Date(Date.now() - 86400000),
        volume: 31800.00,
        temperature: 84.2,
        api_gravity: 28.4,
        bsw: 0.6,
        level_inches: 378.00,
        gauged_by: adminId,
        gauging_method: 'MANUAL',
        notes: 'Medición del día anterior',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tank_id: tanks[3].id,
        gauging_datetime: new Date(),
        volume: 21000.00,
        temperature: 82.0,
        api_gravity: 30.2,
        bsw: 0.3,
        level_inches: 320.00,
        gauged_by: adminId,
        gauging_method: 'RADAR',
        notes: 'Medición automática',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
    ];

    await queryInterface.bulkInsert('tank_gaugings', gaugings);

    // Loading Tickets
    const tickets = [
      {
        id: uuidv4(),
        code: 'TKT-2024-0001',
        type: 'LOADING',
        source_tank_id: tanks[0].id,
        destination: 'Refinería Central',
        vehicle_plate: 'ABC-123',
        driver_name: 'Juan Pérez',
        driver_id_number: 'V-12345678',
        carrier_company: 'Transporte Petrolero C.A.',
        product_type: 'CRUDE',
        api_gravity: 28.5,
        bsw: 0.5,
        temperature: 85.0,
        gross_volume: 180.00,
        net_volume: 179.10,
        loading_start: new Date(Date.now() - 3600000),
        loading_end: new Date(),
        seal_numbers: JSON.stringify(['SEAL-001', 'SEAL-002']),
        initial_tank_volume: 32680.00,
        final_tank_volume: 32500.00,
        authorized_by: adminId,
        received_by: 'Carlos Rodríguez',
        status: 'COMPLETED',
        notes: 'Despacho normal',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'TKT-2024-0002',
        type: 'LOADING',
        source_tank_id: tanks[0].id,
        destination: 'Terminal Marítimo',
        vehicle_plate: 'XYZ-789',
        driver_name: 'Pedro González',
        driver_id_number: 'V-87654321',
        carrier_company: 'Logística Petrolera S.A.',
        product_type: 'CRUDE',
        api_gravity: 28.5,
        bsw: 0.5,
        temperature: 86.0,
        gross_volume: 200.00,
        net_volume: null,
        loading_start: new Date(),
        loading_end: null,
        seal_numbers: JSON.stringify([]),
        initial_tank_volume: 32500.00,
        final_tank_volume: null,
        authorized_by: adminId,
        received_by: null,
        status: 'IN_PROGRESS',
        notes: 'En proceso de carga',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'TKT-2024-0003',
        type: 'TRANSFER',
        source_tank_id: tanks[3].id,
        destination_tank_id: tanks[0].id,
        destination: null,
        vehicle_plate: null,
        driver_name: null,
        driver_id_number: null,
        carrier_company: null,
        product_type: 'CRUDE',
        api_gravity: 30.2,
        bsw: 0.3,
        temperature: 82.0,
        gross_volume: 500.00,
        net_volume: 498.50,
        loading_start: new Date(Date.now() - 86400000),
        loading_end: new Date(Date.now() - 82800000),
        seal_numbers: JSON.stringify([]),
        initial_tank_volume: 21500.00,
        final_tank_volume: 21000.00,
        authorized_by: adminId,
        received_by: 'Operador de Tanques',
        status: 'COMPLETED',
        notes: 'Transferencia entre tanques',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
    ];

    await queryInterface.bulkInsert('loading_tickets', tickets);

    // Crude Quality
    const qualities = [
      {
        id: uuidv4(),
        code: 'QTY-2024-0001',
        field_id: fieldId1,
        tank_id: tanks[0].id,
        sample_date: new Date().toISOString().split('T')[0],
        sample_time: '08:00:00',
        sample_point: 'Salida de tanque TNK-0001',
        api_gravity: 28.5,
        bsw: 0.50,
        sulfur_content: 1.25,
        viscosity: 45.5,
        pour_point: 15.0,
        salt_content: 8.5,
        h2s_content: 25.0,
        reid_vapor_pressure: 4.5,
        flash_point: 120.0,
        lab_report_number: 'LAB-2024-0125',
        lab_name: 'Laboratorio Central',
        sampled_by: adminId,
        analyzed_by: 'Dr. María López',
        status: 'APPROVED',
        notes: 'Muestra de rutina',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'QTY-2024-0002',
        field_id: fieldId2,
        tank_id: tanks[3].id,
        sample_date: new Date().toISOString().split('T')[0],
        sample_time: '10:30:00',
        sample_point: 'Salida de tanque TNK-0004',
        api_gravity: 30.2,
        bsw: 0.30,
        sulfur_content: 0.95,
        viscosity: 38.2,
        pour_point: 10.0,
        salt_content: 6.2,
        h2s_content: 15.0,
        reid_vapor_pressure: 5.2,
        flash_point: 115.0,
        lab_report_number: 'LAB-2024-0126',
        lab_name: 'Laboratorio Central',
        sampled_by: adminId,
        analyzed_by: 'Dr. María López',
        status: 'APPROVED',
        notes: 'Crudo liviano de alta calidad',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'QTY-2024-0003',
        field_id: fieldId1,
        tank_id: tanks[0].id,
        sample_date: new Date().toISOString().split('T')[0],
        sample_time: '14:00:00',
        sample_point: 'Línea de entrada',
        api_gravity: 27.8,
        bsw: 0.65,
        sulfur_content: 1.35,
        viscosity: 48.0,
        pour_point: 18.0,
        salt_content: 9.5,
        h2s_content: 30.0,
        reid_vapor_pressure: 4.2,
        flash_point: 125.0,
        lab_report_number: null,
        lab_name: null,
        sampled_by: adminId,
        analyzed_by: null,
        status: 'PENDING',
        notes: 'Pendiente de análisis de laboratorio',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
    ];

    await queryInterface.bulkInsert('crude_qualities', qualities);

    // Pipelines
    const pipelines = [
      {
        id: uuidv4(),
        code: 'PIP-0001',
        name: 'Oleoducto Principal',
        type: 'CRUDE',
        origin: 'Estación Central',
        origin_field_id: fieldId1,
        destination: 'Terminal Marítimo',
        destination_field_id: null,
        length_km: 85.5,
        diameter_inches: 16.00,
        wall_thickness_inches: 0.375,
        material: 'Carbon Steel API 5L X52',
        capacity_bpd: 50000.00,
        max_pressure_psi: 1200.00,
        installation_date: '2015-06-15',
        last_inspection_date: new Date(Date.now() - 30 * 86400000),
        next_inspection_date: new Date(Date.now() + 335 * 86400000),
        status: 'ACTIVE',
        operator: 'Operaciones Petroleras C.A.',
        notes: 'Oleoducto principal de exportación',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'PIP-0002',
        name: 'Gasoducto Norte',
        type: 'GAS',
        origin: 'Planta de Gas',
        origin_field_id: fieldId2,
        destination: 'Planta de Procesamiento',
        destination_field_id: null,
        length_km: 45.2,
        diameter_inches: 12.00,
        wall_thickness_inches: 0.312,
        material: 'Carbon Steel API 5L X60',
        capacity_bpd: null,
        max_pressure_psi: 1500.00,
        installation_date: '2018-03-20',
        last_inspection_date: new Date(Date.now() - 60 * 86400000),
        next_inspection_date: new Date(Date.now() + 305 * 86400000),
        status: 'ACTIVE',
        operator: 'Operaciones Petroleras C.A.',
        notes: 'Gasoducto para transporte de gas natural',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'PIP-0003',
        name: 'Línea de Transferencia',
        type: 'CRUDE',
        origin: 'Estación Norte',
        origin_field_id: fieldId2,
        destination: 'Estación Central',
        destination_field_id: fieldId1,
        length_km: 25.8,
        diameter_inches: 10.00,
        wall_thickness_inches: 0.250,
        material: 'Carbon Steel API 5L X42',
        capacity_bpd: 25000.00,
        max_pressure_psi: 800.00,
        installation_date: '2020-09-10',
        last_inspection_date: new Date(Date.now() - 15 * 86400000),
        next_inspection_date: new Date(Date.now() + 350 * 86400000),
        status: 'ACTIVE',
        operator: 'Operaciones Petroleras C.A.',
        notes: 'Línea de transferencia entre estaciones',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        code: 'PIP-0004',
        name: 'Línea de Agua',
        type: 'WATER',
        origin: 'Estación Central',
        origin_field_id: fieldId1,
        destination: 'Planta de Tratamiento',
        destination_field_id: null,
        length_km: 12.5,
        diameter_inches: 8.00,
        wall_thickness_inches: 0.188,
        material: 'Carbon Steel API 5L B',
        capacity_bpd: 15000.00,
        max_pressure_psi: 500.00,
        installation_date: '2019-11-05',
        last_inspection_date: new Date(Date.now() - 90 * 86400000),
        next_inspection_date: new Date(Date.now() + 275 * 86400000),
        status: 'MAINTENANCE',
        operator: 'Operaciones Petroleras C.A.',
        notes: 'En mantenimiento preventivo',
        created_by: adminId,
        created_at: now,
        updated_at: now,
      },
    ];

    await queryInterface.bulkInsert('pipelines', pipelines);
  },

  async down(queryInterface, Sequelize) {
    await queryInterface.bulkDelete('pipelines', null, {});
    await queryInterface.bulkDelete('crude_qualities', null, {});
    await queryInterface.bulkDelete('loading_tickets', null, {});
    await queryInterface.bulkDelete('tank_gaugings', null, {});
    await queryInterface.bulkDelete('storage_tanks', null, {});
  }
};
